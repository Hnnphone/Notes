## 性能优化的相关面试题
>copy by 雅虎 35 条军规

### 一、页面内容
#### 1.1 减少HTTP请求数
- 合并JS/CSS文件
- 使用CSS Sprite将背景图片合并成一个文件
- 使用data uri scheme加载经过base64编码的图片资源

#### 1.2 减少DNS查询
- 减少不同的主机名，折中方案是把组件分散在2到4个主机名下

#### 1.3 避免重定向
- 比如url末尾应该添加 / 但未添加

#### 1.4 缓存Ajax请求
- 通过给资源的Ajax url里添加一个表明用户资源最后修改时间的时间戳来实现

#### 1.5 延迟加载
- 非首屏使用的数据、样式、脚本、图片等
- 用户交互时才会显示的内容
- 遵循「渐进增强」理念开发的网站，即没有也可以正常工作

#### 1.6 预加载
- 无条件预先加载，如Sprite图片
- 有条件预先加载，需根据用户行为预判用户去向
- 有「阴谋」的预先加载，页面即将上线新版前预先加载新版内容，以便新版上线更快的载入

#### 1.7 减少DOM元素数量
- 是否还在使用表格布局？
- 塞进去更多的div仅为了处理布局问题？
- 能通过伪元素实现的功能，就没必要添加额外元素，如清除浮动

#### 1.8 划分内容到不同域名
- 使用不同的域名可以最大化下载线程，但注意保持在2-4个域名内，以避免DNS查询损耗

#### 1.9 尽量减少iframe的使用
- 加载代价昂贵，即使是空的页面
- Iframe完全加载以后，父页面才会触发load事件

### 二、服务器
#### 2.1 使用CDN
- 用户与服务器的物理距离对响应时间也有影响，
- 把内容部署在多个地理位置分散的服务器上能让用户更快地载入页面

#### 2.2 添加Expires或Cache-Control响应头
- 静态内容：将Expires响应头设置为将来很远的时间，实现「永不过期」策略
- 动态内容：设置合适的Cache-Control响应头，让浏览器有条件地发起请求

#### 2.3 配置Etag

#### 2.4 启用Gzip
- Gzip压缩通常可以减少70%的响应大小，对某些文件更可能高达90%
- 注意！！图片和PDF文件不要使用gzip。它们本身已经压缩过

#### 2.5 尽早输出（flush）缓冲
- 可以考虑在head结束标签之后输出一次缓冲，以便浏览器开始加载CSS资源

#### 2.6 Ajax请求使用GET方法
- POST请求时分成两步，先发送Http Header，再发送data。而GET只使用一个TCP数据包

#### 2.7 避免图片src为空
- 虽然src属性为空字符串，但浏览器仍然会向服务器发起一个HTTP请求，浪费服务器计算资源

### 三、Cookie
#### 3.1 减少Cookie大小
- 减少Cookie大小可以降低其对响应速度的影响
- 去除不必要的Cookie，尽量压缩Cookie大小

#### 3.2 静态资源使用无Cookie域名
- 静态资源一般无需使用Cookie，可以把它们放在使用二级域名或者专门域名的无Cookie服务器上

### 四、CSS
#### 4.1 把样式表放在head标签中
- 可以让页面渐进渲染，尽早呈现视觉反馈，CSS在解析过程中不会影响到DOM树的生成

#### 4.2 不要使用CSS表达式
- CSS表达式超出预期的频繁执行，会带来很大的性能损耗

#### 4.3 使用link替代@import
- 对于IE某些版本，@import的行为和放在页面底部一样

#### 4.4 不要使用filter
- 在图片加载过程中，这个滤镜会阻塞渲染，卡住浏览器
- 注意！！这里所说的不是CSS3 Filter

### 五、JavaScript
#### 5.1 把脚本放在页面底部
- 浏览器下载脚本时，会阻塞其他资源并行下载，即使是来自不同域名的资源
- 与GUI线程互斥

#### 5.2 使用外部JavaScript和CSS
- 外部JavaScript和CSS文件可以被浏览器缓存
- 当然，实际中也需要考虑代码的重用程度

#### 5.3 压缩JavaScript和CSS
- 压缩代码可以移除非功能性的字符（注释、空格、空行等），减少文件大小，提高载入速度。如 htmlmin

#### 5.4 移除重复脚本

#### 5.5 减少DOM操作
- 每一次DOM操作都会导致页面的重排或重绘
- 我们可以使用DocumentFragment暂存DOM，整理好以后再插入DOM树
- 操作className，而不是多次读写style

#### 5.6 使用高效的事件处理
- 减少绑定事件监听的节点，如通过事件委托
- 尽早处理事件，在DOMContentLoaded即可进行，不用等到load以后

### 六、图片
#### 6.1 优化图片


#### 6.2 优化CSS Sprite
- 水平排列Sprite中的图片，垂直排列会增加图片大小
- 把颜色较近的组合在一起可以降低颜色数

#### 6.3 不要在HTML中缩放图片
- 很多CMS和CDN都提供图片裁切功能，以便图片与指定大小一一对应

#### 6.4 使用体积小、可缓存的favicon.ico
- 保证存在，避免404
- 尽量小，最好小于1K
- 设置较长的过期时间

### 七、移动端
#### 7.1 保证所有组件都小于25K
- 因为iPhone不能缓存大于25K的组件，这里指的是未压缩的大小

#### 7.2 打包内容为分段（multipart）文档

### 总结

经过分类，可以发现，性能优化主要切入点可以从以下几个方面去考虑：
- 资源本身大小的压缩优化
- 网络请求的全过程
- 浏览器渲染全过程